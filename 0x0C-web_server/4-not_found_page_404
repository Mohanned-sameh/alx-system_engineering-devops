#!/bin/bash

# Update package list
sudo apt-get update -y

# Install Nginx
sudo apt-get install nginx -y

# Create a basic HTML page with the custom 404 message
echo '<html><head><title>404 Not Found</title></head><body><p>Ceci n'\''est pas une page</p></body></html>' | sudo tee /var/www/html/custom_404.html > /dev/null

# Make sure Nginx is listening on port 80
sudo sed -i 's/^\s*listen\s*\(.*\);/listen 80;/' /etc/nginx/sites-available/default

# Configure the custom 404 page
echo 'server {' | sudo tee -a /etc/nginx/sites-available/default > /dev/null
echo '    listen 80;' | sudo tee -a /etc/nginx/sites-available/default > /dev/null
echo '    server_name _;' | sudo tee -a /etc/nginx/sites-available/default > /dev/null
echo '    error_page 404 /custom_404.html;' | sudo tee -a /etc/nginx/sites-available/default > /dev/null
echo '    location = /custom_404.html {' | sudo tee -a /etc/nginx/sites-available/default > /dev/null
echo '        root /var/www/html;' | sudo tee -a /etc/nginx/sites-available/default > /dev/null
echo '        internal;' | sudo tee -a /etc/nginx/sites-available/default > /dev/null
echo '    }' | sudo tee -a /etc/nginx/sites-available/default > /dev/null
echo '}' | sudo tee -a /etc/nginx/sites-available/default > /dev/null

# Restart Nginx (without using systemctl)
sudo /etc/init.d/nginx restart

# Check if Nginx is running
nginx_pid=$(pgrep nginx)
if [ -z "$nginx_pid" ]; then
  echo "Nginx failed to start. Check the logs in /var/log/nginx/error.log for more information."
else
  echo "Nginx is running on port 80 with custom 404 page configured."
fi
